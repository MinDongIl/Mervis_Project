[연구 일지] 2026-02-11

1. 주요 내용
인프라 분리(학습용/서비스용) 시도 중 발생한 Python 3.12 환경의 Docker 빌드 의존성 충돌 해결 및 GCP IAM 권한 재설정을 통한 서비스 정상화.

2. 진행 요약
기존 실시간 종목 추천 기능은 안정화되었으나, 서버 용도 분리를 위한 배포 과정에서 심각한 라이브러리 충돌 문제가 발생함.
Python 3.12 환경에서 pip, numpy, yfinance 간의 버전 호환성 문제(Dependency Hell)가 지속되어 배포가 중단됨.
이를 해결하기 위해 pip 버전을 최신화하고 requirements.txt의 과도한 버전 제약을 해제하는 전략으로 빌드를 성공시킴.
이후 서버 런타임에서 발생한 모듈 미인식 문제와 BigQuery 접근 권한(403) 오류를 컨테이너 이미지 갱신 및 IAM 역할 부여를 통해 해결하여 서비스를 정상 궤도에 올림.

3. 주요 수정 및 개발 내용
Docker 빌드 환경 개선 (Dependency Resolution):
requirements.txt 내의 불필요한 특정 버전 명시(Hard-coded versions)를 제거.
pip 버전을 26.0.1(최신)로 유지하며 의존성 해결(Resolver) 기능을 최대한 활용하도록 설정 변경.

서버 배포 프로세스 (Deployment):
VM 내 잔존하던 구버전 Docker 이미지(Dangling images) 강제 삭제 및 최신 이미지 Pull 수행.

권한 설정 (IAM & Security):
Compute Engine의 Service Account에 대한 BigQuery 접근 권한 재검토.
단순 API Scope 허용만으로는 해결되지 않음을 확인 후, IAM 콘솔에서 해당 주 구성원에게 'BigQuery 관리자' 권한을 명시적으로 부여.

4. 시행 착오 및 오류 해결
[Docker 빌드 시 라이브러리 버전 충돌]
증상: pip install 과정에서 numpy 및 기타 라이브러리 간 의존성 충돌로 빌드 실패.
시도: 개별 라이브러리 버전 고정, Python 버전 다운그레이드(3.12 미만), pip 버전 다운그레이드(24.1 미만) 시도했으나 모두 실패.
해결: pip를 최신 버전(26.0.1)으로 유지하고, requirements.txt의 모든 버전 제약 조건을 제거하여 패키지 관리자가 최적의 호환 버전을 찾도록 유도함.

[컨테이너 실행 시 ModuleNotFoundError (yfinance)]
증상: 빌드 성공 후 배포했으나, 서버 실행 로그에서 yfinance 모듈을 찾을 수 없다는 에러 발생.
원인: VM이 레지스트리에 업데이트된 이미지를 받아오지 않고, 로컬에 캐시된 구버전 이미지를 사용하여 실행함.
해결: 서버 내 기존 도커 이미지를 삭제하고 최신 태그 이미지를 다시 Pull하여 해결.

[BigQuery 데이터 접근 거부 (403 Forbidden)]
증상: 크롤러 작동 시 BigQuery Job 생성 권한 없음 에러 발생.
시도: VM 인스턴스의 API Access Scope를 '모든 API 허용'으로 변경했으나 실패.
해결: GCP IAM 콘솔에서 서버의 주 구성원(Service Account)에게 BigQuery 관리자 역할을 직접 할당하여 해결.

5. 다음 목표
분리된 인프라 환경에서의 CI/CD 파이프라인 안정성 재검증.
안정화된 빌드 환경을 바탕으로 실시간 매수/매도 알고리즘 고도화 작업 재개.