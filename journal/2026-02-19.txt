[연구 일지] 2026-02-19

1. 주요 내용
CI/CD 파이프라인을 활용한 무중단 배포(Zero-downtime Deployment) 환경 구축 및 배포 실패 감지 시 자동 롤백(Auto-Rollback) 방어 검증 완료 (INF-03).

2. 진행 요약
CI/CD 자동화 환경에서 치명적인 오류가 포함된 코드가 배포되었을 때 인프라가 어떻게 서비스를 방어하는지 검증하기 위한 테스트(INF-03)를 수행함.
고의로 실행 직후 종료(sys.exit)되는 불량 코드를 작성하고 Git Push를 통해 Cloud Build 파이프라인을 트리거함.
서비스 중단을 막기 위해 cloudbuild.yaml의 롤링 업데이트 설정에 '--max-unavailable=0' 안전장치를 적용함.
배포 시도 결과, 로드밸런서와 MIG가 신규 불량 인스턴스들의 헬스 체크 실패를 즉각 감지하였고, 신규 배포를 중단(Abandon)함과 동시에 이전 버전(2월 13일 템플릿)의 인스턴스를 보존하여 무중단 서비스 롤백에 성공함.

3. 주요 수정 및 개발 내용
[CI/CD 파이프라인 (Cloud Build)]
무중단 배포 옵션 적용: cloudbuild.yaml 내 MIG 롤링 업데이트 스텝에 '--max-unavailable=0' 옵션을 추가하여 업데이트 중 기존 서버 종료 방지.
리전형 설정 최적화: '--max-surge=3' 옵션을 적용하여 Regional MIG의 다중 Zone 배분 규칙을 충족시킴.

[Security & Permissions (IAM)]
권한 부여: 자동 배포를 위해 Cloud Build 서비스 계정(로봇)에 'Compute 인스턴스 관리자(roles/compute.instanceAdmin.v1)' 권한을 부여함.

[Test Method (Chaos Engineering)]
장애 주입: app.py에 고의적인 Runtime Error 코드를 주입하고 자동화 파이프라인에 태워 시스템의 자가 복원 메커니즘을 작동시킴.

4. 시행 착오 및 오류 해결
[리전형 MIG의 max-surge 설정 제약 (Code 1)]
증상: Cloud Build 배포 스텝에서 'Invalid value... maxSurge has to be either 0 or at least equal to the number of zones' 오류 발생.
원인: 리전형 인스턴스 그룹은 새 인스턴스 추가 시 리전 내 각 Zone에 균등하게 배분해야 하므로 최소 3개(Zone 개수) 단위로 설정해야 함을 확인.
해결: cloudbuild.yaml에서 '--max-surge=1'을 '--max-surge=3'으로 수정하여 파이프라인 통과.

[PowerShell 모니터링 에러 출력 (502 Bad Gateway)]
증상: 터미널에서 curl 요청 모니터링 중, 롤백 찰나의 순간에 502 에러와 함께 붉은색 예외 텍스트가 화면을 도배함.
원인: PowerShell의 Invoke-WebRequest는 400~500번대 상태 코드를 예외(Exception)로 처리하는 특성이 있음. 로드밸런서가 신규 서버의 응답 불가를 감지하는 과정에서 발생한 자연스러운 502 에러임.
해결: try-catch 구문을 활용한 PowerShell 스크립트로 모니터링 방식을 변경하여 시스템 내부의 롤백 과정을 안정적으로 관찰함.

5. 다음 목표
SRE 포트폴리오 Lv.2 시나리오 진행: Secret Manager 접근 통제(INF-04) 보안 테스트 수행.
모니터링 체계 구축: 디스크/메모리 고갈 알림(INF-05) 구성.
CPU 부하 테스트를 통한 Auto-scaling(자동 증설) 동작 검증 및 Discord Webhook 장애 알림 연동 완료.