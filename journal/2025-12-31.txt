[연구 일지] 2025-12-31
주요 작업: 머비스 대규모 진화 (V9.3 → V11.9) - 클라우드 이식 및 인지 능력 확장

1. 주요 작업 내역 (Evolution History)
Phase 1. 인프라 대전환 (Local to Cloud)

기존(V9.3): 로컬 JSON 파일에 의존하여 데이터 유실 위험 및 확장성 부족.

변경: Google BigQuery 연동. trade_history(매매기억)와 user_info(사용자 프로필) 테이블을 구축하여 영구적이고 방대한 기억 저장소 확보.

Phase 2. 데이터 신뢰성 확보 (Data Pipeline)

뉴스 엔진 교체: 불안정한 yfinance를 제거하고, Google News RSS를 직접 파싱하는 독자적인 뉴스 수집 엔진 탑재. "No Title" 문제 해결.

거래량 보정(Fallback): 무료 API의 한계(실시간 거래량 0)를 극복하기 위해, 전일 누적 거래량을 자동으로 참조하는 예외 처리 로직 구현.

Phase 3. 인지 능력 고도화 (Cognitive System)

Smart Filtering (프로필): 사용자의 모든 말을 저장하던 비효율 개선. AI가 "투자 성향과 관련된 정보인가?"를 판단하여 잡담은 거르고 핵심 정보만 BigQuery에 저장.

Memory Injection (기억 주입): 대화 시작 시 자신이 아는 종목 목차(Index)를 로드하고, 사용자가 특정 종목을 언급하면 상세 리포트(Body)를 즉시 인출하여 할루시네이션 방지.

Phase 4. 행동하는 AI (Action Trigger)

Sniper Mode: 스캔 리스트에 없는 종목도 즉시 검색 가능하도록 개선.

In-Chat Analysis: 대화 도중 "지금 분석해줘"라는 요청이 들어오면, 대화창을 벗어나지 않고 백그라운드에서 API를 호출하여 즉시 결과를 내놓는 실시간 대응 체계 완성.

2. 시행착오 및 해결 (Troubleshooting)
오류 1: BigQuery 날짜 정렬 및 파싱 실패

증상: DB에 데이터가 쌓여도 조회 시 0개로 뜨거나 에러 발생.

원인: DISTINCT와 ORDER BY의 충돌, 그리고 복잡한 PARSE_TIMESTAMP 함수의 형식 불일치.

해결: GROUP BY ticker와 ORDER BY MAX(log_date) 조합으로 쿼리 로직을 단순화하여 해결.

오류 2: 기억 인출 실패 (Context Missing)

증상: "추천해줘"는 되는데 "상세 설명해줘"는 못 함.

원인: 토큰 비용 문제로 '목차'만 기억하고 '내용'을 로드하지 않았음.

해결: 사용자의 발화에서 티커(Ticker)가 감지되는 순간, 해당 종목의 상세 데이터를 동적으로 로드하는 'On-Demand' 방식 구현.

오류 3: 프로필 오염

증상: 사용자의 불만이나 단순 응답까지 프로필에 저장됨.

해결: 프로필 업데이트 함수에 Gatekeeper 프롬프트를 심어, 정보 가치가 없는 입력은 SKIP 처리하도록 방어 기제 구축.

3. 성과 분석
V9.3의 단순 차트 분석기를 넘어, **기억(DB) + 감각(News) + 행동(Trigger)**을 갖춘 온전한 **AI 파트너(V11.9)**로 도약함.

4. 내일의 목표
자연어 트리거 고도화: 단순 키워드 매칭을 넘어선 문맥 기반의 분석 요청 감지.

매매 연동 가능성 타진: 분석된 진입/청산 가격을 실제 주문 시스템(kis_order)과 연동하는 시나리오 설계.

UI/UX 최적화: 터미널 출력 가독성 개선.