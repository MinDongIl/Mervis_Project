[연구 일지] 2025-12-31
주요 내용: 하이브리드 아키텍처 구축 및 투자 전략(Core & Satellite) 고도화

[Note] 현재는 개발 단계(Dev)이며, 실제 자금이 투입되어 투자가 시작되는 시점을 Version 1.0으로 정의합니다.

1. 목표 및 진행 요약
기억의 격리: 실전 투자와 모의 투자의 데이터를 완벽히 분리하여 학습 무결성 확보.

하이브리드 엔진: 대규모 데이터 분석(BigQuery)과 초고속 실시간 감시(WebSocket)의 결합.

전략 고도화: 단순 거래량 분석을 넘어 '캔들 패턴(OHLC)' 및 '등락률(Ranking)'을 반영한 종목 선별.

2. 주요 수정 및 개발 내용 (통합)
[1] 뇌 구조 및 기억 시스템 (Brain & Memory)

모드별 격리: BigQuery 쿼리에 mode 조건을 강제하여, 모의투자 데이터가 실전 분석을 오염시키지 않도록 차단.

공백기 추적: 프로그램이 꺼져있던 기간의 주가 흐름(Gap Analysis)을 분석하여 맥락을 유지.

캔들 분석: 단순 종가가 아닌 시가/고가/저가(OHLC)를 분석하여 시장의 에너지를 해석하는 로직 탑재.

[2] 데이터베이스 및 종목 관리 (BigQuery & Scan)

DB 갱신 방식 변경: 스트리밍 버퍼 락(Lock) 이슈 해결을 위해, UPDATE 쿼리 대신 테이블 전체를 덮어쓰기(Overwrite) 하는 방식으로 전환하여 안정성 확보.

데이터 필드 확장: 종목 등급 외에 **'등락률(change_rate)'**과 '직전 거래량(last_volume)' 필드를 추가하여 급등주 포착 능력 강화.

전략적 선별(Core & Satellite):

Core (30개): 거래량이 검증된 주도주(ACTIVE_HIGH) 위주 편성.

Satellite (10개): 전일 등락률 상위 종목(Top Gainers)을 섞어 변동성 수익 추구.

[3] 실시간 통신 및 효율화 (WebSocket & Auth)

웹소켓 모듈 탑재: 선별된 40개 종목의 호가를 0.1초 단위로 수신하는 감시 시스템 구축.

스마트 캐싱: API 토큰과 접속키를 로컬 파일에 저장하여, 재실행 시 불필요한 발급 대기 시간을 0으로 단축.

3. 시행착오 및 해결 (Troubleshooting)
[데이터 오염] 모의투자 기록이 실전 분석에 영향을 주는 현상.

→ [해결] DB 조회 시 WHERE mode = current_mode를 필수 조건으로 추가하여 논리적 벽 설치.

[DB 락(Lock)] BigQuery에 데이터를 넣은 직후 수정이 불가능했던 오류.

→ [해결] 데이터 추가가 아닌 '테이블 교체(Write Truncate)' 방식으로 변경하여 대기 시간 없이 즉시 갱신 성공.

[API 차단] yfinance로 6,000개 종목 조회 시 요청 과다로 차단됨.

→ [해결] 배치 작업 사이에 2초의 딜레이(time.sleep)를 두어 안정적 수집 구현.

[검색 실패] 사용자 선호 태그와 DB 내 섹터명이 달라 결과가 0건이 되는 문제.

→ [해결] 태그 매칭 실패 시, 자동으로 'Core & Satellite' 전략으로 우량주를 뽑아오도록 안전장치(Fallback) 마련.

4. 다음 단계 목표
실전 장 개장 시 웹소켓 데이터 수신 지연(Latency) 테스트.

실시간 가격 변동에 따른 구체적 매수 시그널 포착 로직(뇌동매매 방지) 점검.