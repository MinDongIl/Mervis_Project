[연구 일지] 2026-01-06

1. 주요 내용 머비스의 분석 결과를 수치화하여 DB에 저장하는 구조 확립 및 과거 예측의 적중 여부를 자동으로 검증하는 '자기 복기 시스템(1단계: 채점관)' 구현.

2. 진행 요약 기존 텍스트 형태의 리포트 저장 방식에서 벗어나, 목표가/손절가/매매 포지션(BUY/SELL/HOLD)을 정형 데이터로 추출하여 BigQuery에 저장하도록 구조를 개편함. 또한, 프로그램 실행 시 과거의 예측 데이터와 실제 차트 데이터를 대조하여 승(WIN)/패(LOSE)를 판정하는 '채점관 모듈(mervis_examiner)'을 개발하고, 이를 main.py 시작 루틴에 연동하여 시스템의 메타 인지 능력을 확보함.

3. 주요 수정 및 개발 내용

분석 데이터 구조화 (mervis_brain.py): Gemini 리포트 텍스트에서 정규표현식(Regex)을 이용해 전략(Action), 목표가, 손절가를 수치로 추출하는 전처리 로직 추가.

DB 스키마 확장 (mervis_bigquery.py): trade_history 테이블에 예측 검증을 위한 컬럼(action, target_price, cut_price, result_status)을 추가하고, 스키마 자동 업데이트 기능 구현.

채점관 시스템 구축 (mervis_examiner.py):

과거 PENDING 상태의 기록을 조회하여 현재 차트 데이터와 대조.

매매 판정: 목표가 도달 시 WIN, 손절가 이탈 시 LOSE 처리.

관망 판정(신규): '관망(HOLD)' 의견 제시 후 급등 시 기회비용 발생(LOSE), 하락/횡보 시 방어 성공(WIN)으로 판정하는 로직 적용.

자동 실행 연동 (main.py): 프로그램 부팅 시점(system_init)에 채점관을 선행 가동하여, 부재중이었던 기간의 매매 성과를 자동으로 업데이트하도록 설정.

4. 시행 착오 및 오류 해결

[코드 오류] mervis_brain에서 DB 저장 함수 호출 시 인자명 불일치(current_price vs price)로 인한 TypeError 발생.

[해결] 변수명 통일 및 인자 전달 순서 수정.

[데이터 정합성] 모의투자(MOCK) 서버 사용 시 과거 일봉 차트 데이터가 일부 누락되어 채점이 불가능한 현상 확인.

[해결] 채점 모듈(mervis_examiner) 가동 시에는 강제로 실전(REAL) 서버를 바라보도록 설정하여 데이터 신뢰도 확보.

[로직 개선] 초기 구현 시 BUY/SELL에 대해서만 채점을 진행하여, '관망' 의견에 대한 검증이 누락됨.

[해결] 채점 대상을 전체(BUY/SELL/HOLD/WAIT)로 확장하고, 관망 의견에 대해서도 기회비용과 위험 회피 여부를 따지는 채점 로직을 추가함.

5. 다음 목표

오답 노트 (Review Note): 채점 결과가 LOSE인 건에 대하여, 당시의 분석 리포트와 실제 차트 흐름을 비교 분석하여 실패 원인을 규명하는 피드백 루프 구현.