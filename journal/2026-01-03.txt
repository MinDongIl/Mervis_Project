[연구 일지] 2025-01-03
1. 주요 내용 자산 현황 자동 기록 구현 및 한글 섹터명 기반 키워드 생성 로직 개선

2. 진행 요약 증권사 API를 연동하여 프로그램 시작 시 자산 현황이 DB에 자동 기록되도록 기능을 구현함. 또한 한글로 된 섹터 정보를 처리하지 못해 키워드가 누락되던 문제를 해결하고, 데이터 손실 위험이 있는 불필요한 코드를 제거하여 시스템 안정성을 확보함.

3. 주요 수정 및 개발 내용

kis_account.py (신규): 증권사 API를 통해 총 자산 평가액 및 수익률을 조회하는 전용 모듈 신설.

main.py: 프로그램 구동 시 kis_account 모듈을 호출하여, daily_balance 테이블에 자산 내역을 자동 기록하는 루틴 통합.

mervis_bigquery.py:

자산 변동 이력 저장을 위한 daily_balance 테이블 추가.

deep-translator 라이브러리를 적용하여 태그 검색의 유연성 확보.

데이터 무결성 확보를 위해 조회 모듈이 DB 유니버스를 덮어쓸 위험이 있는 seed_ticker_db 함수 삭제.

update_volume_tier.py: 한글 섹터명 처리 시 매핑되지 않는 경우, 불용어를 제거하고 단어 자체를 키워드로 추출하는 안전장치(Fallback) 로직 추가.

4. 시행 착오 및 오류 해결

[오류] 키워드 컬럼 Null 현상

증상: 거래량 분석 업데이트 후 DB의 keywords 컬럼이 비어있는 문제 발생.

원인: 기존 로직은 영문 섹터명("TECHNOLOGY")만 처리하도록 설계되었으나, 실제 데이터는 한글("건설 및 엔지니어링")로 들어와 매칭에 실패함.

해결: 한글 매핑 로직을 우선 적용하되, 매핑 리스트에 없는 경우 섹터명 텍스트 자체를 가공하여 키워드로 등록하도록 수정.

[위험] 데이터 덮어쓰기 위험 감지

분석: mervis_bigquery.py 내 seed_ticker_db 함수 실행 시, 전체 종목(약 6,000개)이 스캔 대상인 소수 종목(40여 개)으로 덮어씌워져 데이터가 유실될 가능성 확인.

해결: 조회 모듈과 데이터 생성 모듈의 권한을 분리하기 위해 해당 함수를 즉시 삭제 처리.

5. 다음 목표

자동 기록된 자산 데이터(daily_balance)의 적재 상태 모니터링.

실시간 트레이딩 모드 전환을 위한 백그라운드 프로세스 실행 준비.