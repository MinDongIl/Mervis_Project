[연구 일지] 2026-01-05

1. 주요 내용 실시간 디스코드 알림 연동, 미국장 개장 대기 시스템(휴일/서머타임 자동화) 구축 및 자연어 기반 감시 알림 설정 구현.

2. 진행 요약 시스템 신뢰도와 접근성을 높이기 위해 Discord Webhook을 통한 실시간 알림 시스템을 구축함. 또한 장 운영 시간(서머타임, 휴장일)을 자동으로 계산하여 대기하는 스케줄러를 도입해 자동화 수준을 높임. 마지막으로 kis_websocket의 파싱 오류를 수정하고, 대화 모드(mervis_ai)와 연동하여 사용자가 채팅으로 특정 종목의 감시 조건을 설정할 수 있는 파이프라인을 완성함.

3. 주요 수정 및 개발 내용

알림 시스템 (notification.py): Discord Webhook 연동을 통해 장 시작/마감, 급등락 등 주요 이벤트를 모바일로 전송하는 모듈 구현.

스마트 대기 로직 (main.py): holidays 및 pytz 라이브러리를 도입하여 미국 휴장일, 주말, 서머타임 여부를 판단하고 개장 시간(09:30 NY)까지 대기하거나 메뉴로 진입하는 로직 적용.

자산 상세 조회 (kis_account.py): 기존 총액 표시에서 보유 종목별 수량, 평가금액, 수익률을 상세히 파싱하여 출력하도록 개선.

자연어 알림 설정 (mervis_ai.py, kis_websocket.py):

사용자의 자연어 명령(예: "테슬라 300불 되면 알려줘")에서 종목(Ticker), 가격, 조건을 추출하는 Intent Detection 구현.

무조건적인 급등락 알림을 제거하고, 사용자가 등록한 조건(User Watch List) 만족 시에만 알림을 보내도록 로직 최적화.

4. 시행 착오 및 오류 해결

[데이터 오류] 실시간 체결가 수신 시 인덱스 매핑 오류로 비정상적인 등락률(예: 93236%)과 깨진 종목명 출력.

[해결] 데이터 구분자 처리(split('^'))를 명확히 하고, 종목 코드의 불필요한 접두어(DNAS) 제거 로직 추가.

[기획 수정] 모든 종목의 급등락을 알림으로 보낼 경우 스팸 공해가 우려됨.

[해결] 사용자가 직접 요청한 종목만 감시하는 '조건부 알림' 방식으로 변경.

5. 다음 목표

자기 복기 시스템 (Self-Reflection): 매매 종료 후 봇이 자신의 예측과 실제 결과를 대조하여 로그를 남기고, 성공/실패 원인을 분석하는 메타 인지 기능 구현.