[연구 일지] 2025-12-30
주요 작업: 머비스 두뇌 V9.3 업그레이드 (4단계 시계열 통합 & 데이터 호환성 강화)

1. 주요 작업 내역

4단계 시계열 분석(Multi-Timeframe) 통합:

기존 단일(일봉) 분석의 한계를 극복하기 위해 kis_chart.py를 전면 개편.

일(Day), 주(Week), 월(Month), 년(Year) 단위의 데이터를 모두 수집하여 머비스에게 제공하는 로직 구현.

단기 등락과 장기 추세를 복합적으로 분석하여 전략의 신뢰도 향상.

데이터 파싱 호환성 강화 (Brain V9.3):

한국투자증권 API가 상황에 따라 날짜 키값을 다르게 반환(xymd vs cymd)하는 문제 발견.

mervis_brain.py 내 summarize_data 함수에 동적 키 매핑 로직을 추가하여 어떤 키값이 들어와도 데이터 누락 없이 처리하도록 수정.

시스템 모드 동기화 (Sync):

kis_scan.py 등 주변 모듈이 mervis_state의 설정(Real/Mock)을 무시하고 하드코딩된 URL을 참조하던 문제 해결.

전체 모듈이 실전/모의 모드 설정에 따라 API 엔드포인트와 인증키를 일관되게 사용하도록 리팩토링.

보안 이슈 대응:

Git Push 과정에서 실수로 업로드된 민감 정보(secret.py)를 저장소 기록에서 삭제(--cached, --amend)하고 .gitignore 설정을 강화하여 재발 방지 조치.

2. 시행착오 및 오류 분석 (Troubleshooting)

오류 1: VS Code 라이브러리 인식 불가 (Pylance Warning)

증상: 코드는 정상 실행되나 편집기상에서 requests, pandas 등에 노란 줄 경고 발생.

원인: VS Code가 가상환경(venv)이 아닌 글로벌 인터프리터를 참조함.

해결: 인터프리터 경로를 재설정하여 개발 환경 정상화.

오류 2: API 토큰 만료 (Msg: 기간이 만료된 token 입니다)

증상: API 호출 시 인증 실패 에러 발생.

원인: 로컬에 저장된 mervis_token_cache.json 파일의 유효기간이 지났음에도 갱신 없이 재사용함.

해결: 캐시 파일 수동 삭제 후 재실행을 통해 신규 토큰 발급 프로세스 검증.

오류 3: 데이터 수신 후 분석 실패 (No Data Available)

증상: API 호출은 성공했으나, 머비스가 "데이터가 부족하여 분석 불가"라고 응답.

원인: API 응답 데이터의 필드명(xymd)과 코드 상의 요구 필드명(cymd) 불일치.

해결: 전처리 함수에서 키 존재 여부를 확인하고 표준 포맷으로 변환하는 로직 추가. 또한, 디버깅을 위해 프롬프트 내용을 텍스트 파일로 저장하는 기능 구현.

3. 내일의 목표

실전 데이터 검증: 금일 구현한 4단계 시계열 분석 로직이 실제 장 개장(Live) 상황에서 실시간 변동성을 정확히 반영하는지 테스트.

기억(Memory) 검증: 머비스가 과거 분석 기록과 현재 데이터를 비교하여 "자기 반성(Self-Reflection)"을 수행하는지 확인.